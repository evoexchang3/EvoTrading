Trading Platform Question - P&L Calculation Explained
What They're Asking
The trading platform team is asking how the CRM calculates profit because they:

Had a bug: They were using a hardcoded 10,000 multiplier for all instruments
Realized the error: Different instruments have different contract sizes (forex = 100,000, crypto = 1, etc.)
Want to fix it: They need to know the correct way to calculate P&L from the CRM data
How The CRM Calculates P&L (After Recent Updates)
Formula Used by CRM
Unrealized P&L (for open positions):

priceChange = currentPrice - openPrice  // (or reversed for sell positions)
grossPnl = priceChange × quantity × contractMultiplier
netUnrealizedPnl = grossPnl - feesPaid
Realized P&L (when position closes):

priceChange = closePrice - openPrice
grossPnl = priceChange × quantity × contractMultiplier
closeFees = (quantity × closePrice × contractMultiplier) × 0.0005  // 0.05%
totalFees = openFees + closeFees
netRealizedPnl = grossPnl - totalFees
What The Trading Platform Should Do
✅ Option 1: Use CRM's Calculated P&L (RECOMMENDED)
Simple Approach - Just display what the CRM already calculated:

// The CRM already stores calculated P&L in the positions table
// Trading platform should just READ and DISPLAY these values:
SELECT 
  id,
  symbol,
  quantity,
  openPrice,
  currentPrice,
  unrealizedPnl,  -- ✅ Already calculated by CRM (net of fees)
  realizedPnl,    -- ✅ Already calculated by CRM (net of fees)
  fees            -- ✅ Fees paid
FROM positions;
// In your frontend:
position.unrealizedPnl  // Just display this - no calculation needed!
Benefits:

No calculation errors
Always matches CRM exactly
Contract multipliers handled automatically
Fees already deducted
✅ Option 2: Calculate P&L Yourself (For Advanced Features)
If they want to calculate P&L on their side (for real-time updates, custom displays, etc.):

// Read these fields from the shared positions table:
const position = {
  symbol: "EUR/USD",
  quantity: 1.0,
  openPrice: 1.08500,
  currentPrice: 1.08700,
  contractMultiplier: 100000,  // ✅ MUST read from database
  fees: 50.00,
  side: "buy"
};
// Calculate gross P&L:
const priceChange = position.side === 'buy' 
  ? (position.currentPrice - position.openPrice)
  : (position.openPrice - position.currentPrice);
const grossPnl = priceChange 
  × position.quantity 
  × parseFloat(position.contractMultiplier);  // ✅ Use from DB, not hardcoded!
// Calculate net P&L:
const netPnl = grossPnl - parseFloat(position.fees);
// Display:
console.log(`Gross P&L: $${grossPnl.toFixed(2)}`);
console.log(`Fees: $${position.fees}`);
console.log(`Net P&L: $${netPnl.toFixed(2)}`);
Critical: Contract Multipliers by Instrument
The CRM stores the correct multiplier for each position:

Symbol	Contract Multiplier	Example P&L
EUR/USD	100,000	0.0001 × 1.0 lot × 100,000 = $10
BTC/USD	1	$100 × 0.5 × 1 = $50
XAU/USD (Gold)	100	$1 × 1.0 × 100 = $100
ES (S&P 500)	50	1 point × 1 contract × 50 = $50
Key Point: The contractMultiplier field is REQUIRED for accurate P&L calculation and is already stored in every position record by the CRM.

Tell The Trading Platform Team
Simple Answer:
"The CRM now calculates all P&L correctly with contract multipliers and fees already deducted. You have two options:

Option 1 (Easy): Just display unrealizedPnl and realizedPnl directly from the positions table - these are already correct.

Option 2 (Advanced): If you want to calculate P&L yourself for real-time features:

✅ ALWAYS read contractMultiplier from the positions table for each position
✅ NEVER hardcode multipliers (no more 10,000 for everything!)
✅ Use formula: (priceChange × quantity × contractMultiplier) - fees
The positions table now has all the data you need:

contractMultiplier - specific to each instrument
unrealizedPnl - already calculated and net of fees
realizedPnl - already calculated and net of fees
fees - all fees paid
You can remove your frontend P&L calculation entirely and just display the values from the database, or calculate using the contractMultiplier field we provide for each position."

Example For Their Code
Instead of this (WRONG):

// ❌ DON'T DO THIS
const multiplier = 10000; // Hardcoded - WRONG!
const profit = (currentPrice - openPrice) × quantity × multiplier;
Do this (CORRECT):

// ✅ Option 1: Just display CRM's calculation
<div>Profit: ${position.unrealizedPnl}</div>
// ✅ Option 2: Calculate using correct multiplier from DB
const profit = (currentPrice - openPrice) 
  × quantity 
  × parseFloat(position.contractMultiplier); // From database!
Summary: Tell them the CRM already calculates everything correctly. They should either (1) just display the unrealizedPnl field from the database, or (2) if they need to calculate themselves, read the contractMultiplier from the positions table for each position instead of hardcoding 10,000.